<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie UI</title>
    <link rel="stylesheet" href="style/movie.css">
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.3/dist/web3.min.js"></script>
</head>
<body>

    <header>
        <h1>Movie List</h1>
    </header>
    <div class="movie-title">
        <video width="100%" controls>
            <source src="img/title.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
    <div class="movie-container">
        <!-- Movie 1 -->
        <div class="movie-card">
            <img src="img/1.jpg" alt="Movie 1">
            <div class="movie-details">
                <div class="movie-title">Trunk Locked In</div>
                <div class="movie-description">Description for Movie 1.</div>
                <div class="movie-price" data-price-ether="0.01">0.01 Ether</div>
                <button onclick="connectMetamask('Trunk Locked In', 0.01)" class="buy-button" data-movie-title="1">Buy Now</button>
            </div>
        </div>

        <!-- Movie 2 -->
        <div class="movie-card">
            <img src="img/2.jpg" alt="Movie 2">
            <div class="movie-details">
                <div class="movie-title">The Beekeeper</div>
                <div class="movie-description">Description for Movie 2.</div>
                <div class="movie-price" data-price-ether="0.02">0.02 Ether</div>
                <button onclick="connectMetamask('The Beekeeper', 0.02)" class="buy-button" data-movie-title="2">Buy Now</button>
            </div>
        </div>

        <!-- Movie 3 -->
        <div class="movie-card">
            <img src="img/3.jpg" alt="Movie 3">
            <div class="movie-details">
                <div class="movie-title">Fast and Furious 9</div>
                <div class="movie-description">Description for Movie 3.</div>
                <div class="movie-price" data-price-ether="0.03">0.03 Ether</div>
                <button onclick="connectMetamask('Fast and Furious 9', 0.03)" class="buy-button" data-movie-title="3">Buy Now</button>
            </div>
        </div>

        <!-- Movie 4 -->
        <div class="movie-card">
            <img src="img/4.jpg" alt="Movie 4">
            <div class="movie-details">
                <div class="movie-title">Ant-Man and the Wasp Quantumania</div>
                <div class="movie-description">Description for Movie 4.</div>
                <div class="movie-price" data-price-ether="0.04">0.04 Ether</div>
                <button onclick="connectMetamask('Ant-Man and the Wasp Quantumania', 0.04)" class="buy-button" data-movie-title="4">Buy Now</button>
            </div>
        </div>

        <!-- Movie 5 -->
        <div class="movie-card">
            <img src="img/5.jpg" alt="Movie 5">
            <div class="movie-details">
                <div class="movie-title">The Tiger’s Apprentice</div>
                <div class="movie-description">Description for Movie 5.</div>
                <div class="movie-price" data-price-ether="0.05">0.05 Ether</div>
                <button onclick="connectMetamask('The Tiger’s Apprentice', 0.05)" class="buy-button" data-movie-title="5">Buy Now</button>
            </div>
        </div>

        <!-- Movie 6 -->
        <div class="movie-card">
            <img src="img/6.jpg" alt="Movie 6">
            <div class="movie-details">
                <div class="movie-title">One Piece</div>
                <div class="movie-description">Description for Movie 6.</div>
                <div class="movie-price" data-price-ether="0.06">0.06 Ether</div>
                <button onclick="connectMetamask('One Piece', 0.06)" class="buy-button" data-movie-title="6">Buy Now</button>
            </div>
        </div>

        <!-- Movie 7 -->
        <div class="movie-card">
            <img src="img/7.jpg" alt="Movie 7">
            <div class="movie-details">
                <div class="movie-title">barbie mariposa</div>
                <div class="movie-description">Description for Movie 7.</div>
                <div class="movie-price" data-price-ether="0.07">0.07 Ether</div>
                <button onclick="connectMetamask('barbie mariposa', 0.07)" class="buy-button" data-movie-title="7">Buy Now</button>
            </div>
        </div>

        <!-- Movie 8 -->
        <div class="movie-card">
            <img src="img/8.jpg" alt="Movie 8">
            <div class="movie-details">
                <div class="movie-title">Haibara_JAMNIME</div>
                <div class="movie-description">Description for Movie 8.</div>
                <div class="movie-price" data-price-ether="0.08">0.08 Ether</div>
                <button onclick="connectMetamask('Haibara_JAMNIME', 0.08)" class="buy-button" data-movie-title="8">Buy Now</button>
            </div>
        </div>

        <!-- Movie 9 -->
        <div class="movie-card">
            <img src="img/9.jpg" alt="Movie 9">
            <div class="movie-details">
                <div class="movie-title">Avatar: The Way of Water</div>
                <div class="movie-description">Description for Movie 9.</div>
                <div class="movie-price" data-price-ether="0.09">0.09 Ether</div>
                <button onclick="connectMetamask('Avatar: The Way of Water', 0.09)" class="buy-button" data-movie-title="9">Buy Now</button>

            </div>
        </div>

        <!-- Movie 10 -->
        <div class="movie-card">
            <img src="img/10.jpg" alt="Movie 10">
            <div class="movie-details">
                <div class="movie-title">Thor love and thunder </div>
                <div class="movie-description">Description for Movie 10.</div>
                <div class="movie-price" data-price-ether="0.1">0.1 Ether</div>
                <button onclick="connectMetamask('Thor love and thunder ', 0.1)" class="buy-button" data-movie-title="10">Buy Now</button>
            </div>
        </div>
        <div class="ownership-details">
            <h2>Ownership Details</h2>
            <table id="ownershipTable">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Movie Title</th>
                        <th>Owner</th>
                    </tr>
                </thead>
                <tbody id="ownershipBody">
                    <!-- ข้อมูล Ownership จะถูกเพิ่มที่นี่ -->
                </tbody>
            </table>
        </div>
        

             

    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js">
    </script>
   
   <script>
    let account;
    let ownershipData = []; // เก็บข้อมูล Ownership

    const connectMetamask = async (movieTitle, moviePrice) => {
    if (window.ethereum !== undefined) {
        try {
            const accounts = await ethereum.request({ method: "eth_requestAccounts" });
            account = accounts[0];

            ownershipData.push({
                time: new Date().toLocaleString(),
                movieTitle: movieTitle,
                owner: account
            });

            // แสดงข้อมูล Ownership ในตาราง
            displayOwnershipTable();
        } catch (error) {
            console.error("Error connecting to Metamask:", error.message);
        }
    }
}
    const connectContract = async() => {
    const ABI = [
        [
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "address",
                    "name": "buyer",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "string",
                    "name": "movieTitle",
                    "type": "string"
                },
                {
                    "indexed": false,
                    "internalType": "bytes32",
                    "name": "hash",
                    "type": "bytes32"
                }
            ],
            "name": "MoviePurchased",
            "type": "event"
        },
        {
            "anonymous": false,
            "inputs": [
                {
                    "indexed": false,
                    "internalType": "address",
                    "name": "buyer",
                    "type": "address"
                },
                {
                    "indexed": false,
                    "internalType": "string",
                    "name": "movieTitle",
                    "type": "string"
                },
                {
                    "indexed": false,
                    "internalType": "string",
                    "name": "reason",
                    "type": "string"
                }
            ],
            "name": "PurchaseError",
            "type": "event"
        },
        {
            "inputs": [
                {
                    "internalType": "string",
                    "name": "movieTitle",
                    "type": "string"
                }
            ],
            "name": "checkMoviePurchase",
            "outputs": [
                {
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }
            ],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [
                {
                    "internalType": "string",
                    "name": "movieTitle",
                    "type": "string"
                }
            ],
            "name": "purchaseMovie",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
        }
    ]
    ];
    const Address = "";
    window.web3 =  await new Web3(window.ethereum);
    window.contract = await new window.web3.eth.Contract(ABI,Address);
    document.getElementsById("contractArea").innerHTML = "Connnection Status: Success";
}

    const readWord = async () =>{
        const data = await window.contract.methods.getFlower().call();
        document.getElementsById("dataArea").innerHTML = `Word is: ${data}`;
    }

    const displayOwnershipTable = () => {
        const ownershipTableBody = document.getElementById("ownershipBody");

        // ลบข้อมูลเก่าในตาราง
        while (ownershipTableBody.firstChild) {
            ownershipTableBody.removeChild(ownershipTableBody.firstChild);
        }

        // เพิ่มข้อมูลใหม่ลงในตาราง
        ownershipData.forEach((ownership) => {
            const row = ownershipTableBody.insertRow();
            const timeCell = row.insertCell(0);
            const movieTitleCell = row.insertCell(1);
            const ownerCell = row.insertCell(2);

            timeCell.textContent = ownership.time;
            movieTitleCell.textContent = ownership.movieTitle;
            ownerCell.textContent = ownership.owner;
        });
    }

    document.getElementById("buyButton").addEventListener("click", connectMetamask);
</script>
</body>
</html>